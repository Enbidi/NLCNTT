import{_ as g,o as i,j as _,T as I,y as w,z as S,a as s,u as T,c as P,q as C,r as d,A as c,B as m,D,E as L,k as y,w as v,G as $,b as A,x as b,H as R,I as k,J as M}from"./index-b7eedab6.js";const H=function(t){var e={};for(let[a,l]of t.entries())e[a]==null?e[a]=l:(e[a]instanceof Array||(e[a]=[e[a]]),e[a].push(l));return JSON.stringify(e)};const E={},U=t=>(w("data-v-790f523b"),t=t(),S(),t),j=U(()=>s("div",{class:"overlay position-fixed top-0 start-0 w-100 h-100"},[s("div",{class:"lds-roller"},[s("div"),s("div"),s("div"),s("div"),s("div"),s("div"),s("div"),s("div")])],-1));function N(t,e){return i(),_(I,{to:"body"},[j])}const V=g(E,[["render",N],["__scopeId","data-v-790f523b"]]),B={components:{LoadingScreen:V},props:["apiUrl","deletionModal","updationModal","fetchedData"],setup(){var t=T();return{alertsStore:t}},mounted(){this.$el.querySelectorAll(".form-outline").forEach(t=>{new mdb.Input(t).init()})},methods:{_wait(t){return new Promise(e=>{setTimeout(e,t)})},async callAPI(t,e){this.isLoading=!0;const[a,l]=await Promise.all([fetch(t,e),this._wait(700)]);this.isLoading=!1;var o=await a.json();if(!a.ok){o.errors.forEach(r=>{this.alertsStore.push({content:r.msg,type:"danger"})});return}this.errors=[]},async addHandler(t,e){let a=`${this.apiUrl}/add`,l=t.target,o=new FormData(l);var r={method:"POST"};e&&e.sendFile?r.body=o:(r.headers={"Content-Type":"application/json"},r.body=H(o)),this.callAPI(a,r)},async deleteHandler(){let t=this.selectedItem._id,e=`${this.apiUrl}/${t}/delete`,a={method:"DELETE",headers:{"Content-Type":"application/json",Accept:"appilication/json"}};this.callAPI(e,a),this.fetchedData.items=this.fetchedData.items.filter(l=>l._id!=t)},async updateHandler(t,e){if(this.selectedItem==null)return;this.isLoading=!0;let a=t.target,l=new FormData(a),o=this.selectedItem._id,r=`${this.apiUrl}/${o}/update`;var u=[...l];for(const[n,p]of u)(p==this.selectedItem[n]||this.selectedItem&&this.selectedItem[n]!=p&&!p)&&l.delete(n);let h=JSON.stringify(Object.fromEntries(l.entries())),f=e&&e.sendFile?{method:"PATCH",body:l}:{method:"PATCH",headers:{"Content-Type":"application/json"},body:h};this.callAPI(r,f)},selectItem(t){this.selectedItem=t},async deleteSelectedItems(){var t={ids:this.selectedRows.map(l=>l._id)},e={method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},a=`${this.apiUrl}/delete`;await this.callAPI(a,e),this.alertsStore.push({content:"Xóa thành công",type:"success"})},updateSelectedItem(){if(this.selectedRows.length>1){this.alertsStore.push("Không thể sửa nhiều hơn 1 sản phẩm");return}this.selectedItem=this.selectedRows[0],this.updationModal.show()}},data(){return{filters:{name:{value:"",keys:["name"]}},selectedRows:[],currentPage:1,totalPages:1,isLoading:!1,selectedItem:null,errors:null}},watch:{selectedRows(t){console.log("Logged",t),this.fetchedData.selectedItems&&(this.fetchedData.selectedItems=t)}}},O=s("h1",{class:"mt-4"},"Sản phẩm",-1),J=s("ol",{class:"breadcrumb mb-4"},[s("li",{class:"breadcrumb-item active"},"Dữ liệu các sản phẩm")],-1),F={class:"card mb-4"},q=s("div",{class:"card-header"},[s("i",{class:"fas fa-table me-1"}),A(" Bảng Dữ Liệu ")],-1),x={class:"card-body"},z={class:"row mb-3"},X={class:"col-md-10"},G={class:"col-md-2"},K={class:"form-outline"},Q=s("label",{class:"form-label",for:"filter"},"Lọc bằng tên",-1);function W(t,e,a,l,o,r){const u=b("LoadingScreen"),h=b("VTable"),f=b("VTPagination");return i(),P("div",null,[O,J,o.isLoading?(i(),_(u,{key:0})):C("",!0),s("div",F,[q,s("div",x,[s("div",z,[s("div",X,[s("button",{class:"btn btn-primary me-2",onClick:e[0]||(e[0]=n=>t.$refs.table.selectAll())},"Chọn tất cả"),s("button",{class:"btn btn-primary me-2",onClick:e[1]||(e[1]=n=>t.$refs.table.deselectAll())},"Hủy chọn tất cả"),s("button",{class:"btn btn-warning me-2",onClick:e[2]||(e[2]=n=>r.updateSelectedItem())},"Sửa sản phẩm đang chọn"),s("button",{class:"btn btn-danger me-2",onClick:e[3]||(e[3]=n=>r.deleteSelectedItems())},"Xóa sản phẩm đang chọn"),d(t.$slots,"modalTriggerButtons"),d(t.$slots,"additionModal",c(m({addHandler:r.addHandler,errors:o.errors}))),d(t.$slots,"updationModal",c(m({updateHandler:r.updateHandler,errors:o.errors,selectedItem:o.selectedItem}))),d(t.$slots,"deletionModal",c(m({deleteHandler:r.deleteHandler,errors:o.errors,selectedItem:o.selectedItem})))]),s("div",G,[s("div",K,[D(s("input",{type:"text",class:"form-control",id:"filter","onUpdate:modelValue":e[4]||(e[4]=n=>o.filters.name.value=n)},null,512),[[L,o.filters.name.value]]),Q])])]),y(h,$({class:"table table-bordered table-hover",data:a.fetchedData?a.fetchedData.items:[],filters:o.filters,"page-size":20,currentPage:o.currentPage,"onUpdate:currentPage":e[5]||(e[5]=n=>o.currentPage=n),selectionMode:"multiple",onTotalPagesChanged:e[6]||(e[6]=n=>o.totalPages=n),onStateChanged:e[7]||(e[7]=n=>{o.selectedRows=n.selectedRows,a.fetchedData.selectedItems=n.selectedRows}),selectedClass:"bg-primary bg-gradient bg-opacity-50",ref:"table"},t.$attrs),{head:v(()=>[d(t.$slots,"tableColumnNames")]),body:v(({rows:n})=>[d(t.$slots,"tableColumnDatas",c(m({rows:n,selectItem:r.selectItem})))]),_:3},16,["data","filters","currentPage"]),y(f,{currentPage:o.currentPage,"onUpdate:currentPage":e[8]||(e[8]=n=>o.currentPage=n),"total-pages":o.totalPages,"boundary-link":!0,class:"d-flex justify-content-center"},null,8,["currentPage","total-pages"])])])])}const de=g(B,[["render",W]]),Y={props:["id"],inheritAttrs:!1,mounted(){this.$refs.modal.querySelectorAll(".form-outline").forEach(e=>new mdb.Input(e).init());let t=this.$refs.modal;this.instance=mdb.Modal.getInstance(t),this.instance==null&&(this.instance=new mdb.Modal(t))},methods:{show(){this.instance.show()}}},Z=["id","aria-labelledby"],ee={class:"modal-dialog"},te={class:"modal-content"},se={class:"modal-header"},ae=["id"],oe=s("button",{type:"button",class:"btn-close","data-mdb-dismiss":"modal","aria-label":"Close"},null,-1);function ne(t,e,a,l,o,r){return i(),_(I,{to:"body"},[s("div",{class:"modal fade",id:a.id,tabindex:"-1","aria-labelledby":`${a.id}Label`,"aria-hidden":"true",ref:"modal"},[s("div",ee,[s("div",te,[s("div",se,[s("h5",{class:"modal-title",id:`${a.id}Label`},[d(t.$slots,"modalTitle")],8,ae),oe]),d(t.$slots,"default")])])],8,Z)])}const ie=g(Y,[["render",ne]]),le=["data-mdb-target"],ce={__name:"ModalTriggerButton",props:["target"],setup(t){return(e,a)=>(i(),P("button",{type:"button",class:"btn btn-primary","data-mdb-toggle":"modal","data-mdb-target":"#"+t.target},[d(e.$slots,"default")],8,le))}};function me(t){const e=R(null);return k(()=>{const a=M();e.value=a.refs[t]}),e}export{de as C,ie as M,ce as _,me as u};
